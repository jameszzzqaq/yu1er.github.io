<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>yuler's blog</title>
<meta name=keywords content="Blog,Portfolio,PaperMod,Yuler">
<meta name=description content="yuler's blog">
<meta name=author content="yuler">
<link rel=canonical href=https://zhangyh.me/>
<meta name=google-site-verification content="G-JP3WQ36T5K">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabcsadf">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.css rel="preload stylesheet" as=style>
<link rel=icon href=https://zhangyh.me/icon/jiaran16.ico>
<link rel=icon type=image/png sizes=16x16 href=https://zhangyh.me/icon/jiaran16.ico>
<link rel=icon type=image/png sizes=32x32 href=https://zhangyh.me/icon/jiaran32.ico>
<link rel=apple-touch-icon href=https://zhangyh.me/%3Clink%20/%20abs%20url%3E>
<link rel=mask-icon href=https://zhangyh.me/%3Clink%20/%20abs%20url%3E>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<link rel=alternate type=application/rss+xml href=https://zhangyh.me/index.xml>
<link rel=alternate type=application/json href=https://zhangyh.me/index.json>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JP3WQ36T5K"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-JP3WQ36T5K',{anonymize_ip:!1})}</script>
<meta property="og:title" content="yuler's blog">
<meta property="og:description" content="yuler's blog">
<meta property="og:type" content="website">
<meta property="og:url" content="https://zhangyh.me/"><meta property="og:image" content="https://zhangyh.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="yuler's blog">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://zhangyh.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name=twitter:title content="yuler's blog">
<meta name=twitter:description content="yuler's blog">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"yuler's blog","url":"https://zhangyh.me/","description":"yuler\u0026#39;s blog","thumbnailUrl":"https://zhangyh.me/icon/jiaran16.ico","sameAs":["mailto:zyh.me@outlook.com","https://github.com/yu1er"]}</script>
</head>
<body class=list id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://zhangyh.me/ accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://zhangyh.me/archives/ title=archives>
<span>archives</span>
</a>
</li>
<li>
<a href=https://zhangyh.me/categories/ title=categories>
<span>categories</span>
</a>
</li>
<li>
<a href=https://zhangyh.me/tags/ title=tags>
<span>tags</span>
</a>
</li>
<li>
<a href=https://zhangyh.me/search/ title="search (Alt + /)" accesskey=/>
<span>search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class="first-entry home-info">
<header class=entry-header>
<h1>Hi there ğŸŒˆ</h1>
</header>
<section class=entry-content>
<p></p>
</section>
<footer class=entry-footer>
<div class=social-icons>
<a href=mailto:zyh.me@outlook.com target=_blank rel="noopener noreferrer me" title=Email><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 21" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
</a>
<a href=https://github.com/yu1er target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a>
</div>
</footer>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>å•è°ƒæ ˆé¢˜é›†
</h2>
</header>
<section class=entry-content>
<p>å•è°ƒæ ˆ å•è°ƒæ ˆå¯ä»¥ä¿è¯æ ˆå†…å…ƒç´ çº¿æ€§æœ‰åº,åŒæ—¶å¤æ‚åº¦ä¸º$O(n)$.
é€šå¸¸çš„trickä¼šåœ¨é¦–å°¾å¤„æ·»åŠ ä¸¤ä¸ªå“¨å…µå…ƒç´ .
é¢˜ç›® 84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ å¾ˆç»å…¸çš„å•è°ƒæ ˆç”¨æ³•.
class Solution { public: int largestRectangleArea(vector&lt;int>& heights) { vector&lt;int> nums(heights.size() + 2); copy(begin(heights), end(heights), begin(nums) + 1); int n = nums.size(); stack&lt;int> stk; stk.push(0); int ans = 0; for (int i = 1; i &lt; n; i++) { while (nums[i] &lt; nums[stk.top()]) { int h = nums[stk.top()]; stk.pop(); int w = i - stk.top() - 1; ans = max(ans, h * w); } stk....</p>
</section>
<footer class=entry-footer>10-15&nbsp;Â·&nbsp;yuler</footer>
<a class=entry-link aria-label="post link to å•è°ƒæ ˆé¢˜é›†" href=https://zhangyh.me/posts/leetcode/monotone-stack/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>TRIAD: Creating Synergies Between Memory, Disk and Log in Log Structured Key-Value Stores
</h2>
</header>
<section class=entry-content>
<p>Introduction æœ¬æ–‡é€šè¿‡è§£å†³LSM-Treeçš„å†™æ”¾å¤§é—®é¢˜,ä»è€Œæ•´ä½“ä¸Šæé«˜å…¶ååé‡. åœ¨çœŸæ˜¯çš„ç”Ÿäº§ç¯å¢ƒä¸­,ä½œè€…è§‚å¯Ÿåˆ°compactionæœ€é«˜å¯å æ®45%çš„CPU,å¹³å‡æ¯å¤©æœ‰2.5ä¸ªå°æ—¶çš„æ—¶é—´èŠ±åœ¨compactionä¸Š. æ˜¾ç„¶,compactionå’Œflushæ˜¯é‡è¦çš„æ€§èƒ½æŒ‘æˆ˜,å³ä½¿å®ƒä»¬å‘ç”Ÿåœ¨é¢å‘ç”¨æˆ·çš„æ“ä½œçš„å…³é”®è·¯å¾„ä¹‹å¤–.
ä¸»è¦é¢å‘
Background LSM-Tree:
Memory Component Disk Component Commit Log User-facing Operation:
Get(k) Update(k, v) Delete(k) Internal Operation:
Flushing Compaction Movitation é€šè¿‡å®éªŒå°†æ­£å¸¸çš„LSMä¸å»æ‰äº†Disk Componentçš„LSMç›¸æ¯”,å‘ç°æœ‰3xçš„ååæŸå¤±. å®éªŒç¡®å®šäº†æ˜‚è´µçš„ I/O æ“ä½œçš„ä¸‰ä¸ªä¸»è¦æ¥æº,æ¯ä¸ªæ¥æºå¯¹åº”äºLSM-Treeä¸­ä¸‰ä¸ªç»„ä»¶ä¸­çš„ä¸€ä¸ª,å³
data-skew unawareness (memory component) premature and iterative compaction (disk component) duplicated writes (commit log) data-skew unawareness hot keyè¢«é¢‘ç¹æ›´æ–°,é€ æˆäº†commit logå¿«é€Ÿå¢é•¿,ä½†$C_m$å˜åŒ–ä¸å¤§. åœ¨$C_m$è¾¾åˆ°æœ€å¤§å®¹é‡ä¹‹å‰,é¢‘ç¹çš„è§¦å‘æ›´æ–°ï¼ˆä¸ºä»€ä¹ˆï¼Ÿï¼‰,åœ¨L0ä¸­æ‰“å¼€å’Œå­˜å‚¨æ–‡ä»¶çš„å›ºå®šæˆæœ¬ä¸ä¼šå› å®é™…å‘å…¶ä¸­å†™å…¥æ•°æ®è€Œæ‘Šé”€ data-skewå¯¼è‡´$C_d$çš„å¤šå±‚éƒ½ä¼šæœ‰keyçš„å†—ä½™,å­˜å‚¨äº†å¤§é‡çš„è¿‡æ—¶æ•°æ® premature and iterative compaction Leveling compactionå’ŒSize-Tiered Compaction æ¯æ¬¡compacitoné€‰æ‹©L0ä¸­çš„ä¸€ä¸ª,ä½†L0å±‚çš„SSTableçš„keyä¹‹é—´æœ‰äº¤å‰,å³ä½¿ä¸¤ä¸ªSSTableçš„keyäº¤å‰èŒƒå›´å¾ˆå¤§,ä»éœ€è¦è¿›è¡Œä¸¤æ¬¡Compaction,data-skewæ›´æ˜¯ä¼šæ¶åŒ–è¿™ç§æƒ…å†µ.
duplicated writes å½“$C_m$åˆ·æ–°åˆ°$C_d$ä¹‹å,éœ€è¦åˆ é™¤æ‰å…¶åœ¨Commit logä¸­çš„éƒ¨åˆ†....</p>
</section>
<footer class=entry-footer>10-12&nbsp;Â·&nbsp;yuler</footer>
<a class=entry-link aria-label="post link to TRIAD: Creating Synergies Between Memory, Disk and Log in Log Structured Key-Value Stores" href=https://zhangyh.me/posts/paper/oct/triad/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>cppé—®é¢˜æ¸…å•
</h2>
</header>
<section class=entry-content>
<p>é—®é¢˜1 #include &lt;iostream> class A { public: virtual void func(int val = 1) {std::cout &lt;&lt; "A->" &lt;&lt; val &lt;&lt; std::endl; } virtual void test(){func();} }; class B : public A { public: void func(int val = 0) {std::cout &lt;&lt; "B->" &lt;&lt; val &lt;&lt; std::endl;} }; int main () { B* b = new B; b->test(); return 0; } è¾“å‡º B->1
è§£é‡Š å‚è€ƒã€ŠEffective c++ã€‹æ¡æ¬¾37: ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœé»˜è®¤å€¼. å› ä¸ºè™šå‡½æ•°æ˜¯åŠ¨æ€ç»‘å®š,å› æ­¤bå®é™…æŒ‡å‘çš„å°±æ˜¯b.è€Œé»˜è®¤å‚æ•°æ˜¯é™æ€ç»‘å®š,æ˜¯ç”±ç¼–è¯‘å™¨å†³å®šçš„.
testå‡½æ•°æ˜¯Açš„,testå†…éƒ¨è°ƒç”¨funcå®é™…ä¸Šæ˜¯this->func,funcæ˜¯ä¸ªè™šå‡½æ•°è€Œä¸”åœ¨Bä¸­è¢«é‡å†™äº†,æ‰€ä»¥æœ‰åŠ¨æ€ç»‘å®š. è¿™é‡Œçš„thisè¿è¡Œæ—¶ç±»å‹æ˜¯B,æ‰€ä»¥è°ƒç”¨Bçš„func,ä½†æ˜¯ç¼ºçœå‚æ•°å®é™…ä¸Šæ˜¯é™æ€ç»‘å®šçš„,æ‰€ä»¥è¾“å‡ºçš„valæ˜¯Aä¸­çš„é‚£ä¸ªval....</p>
</section>
<footer class=entry-footer>10-10&nbsp;Â·&nbsp;yuler</footer>
<a class=entry-link aria-label="post link to cppé—®é¢˜æ¸…å•" href=https://zhangyh.me/posts/cpp/problem-list/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>priority_queueè‡ªå®šä¹‰æ’åº
</h2>
</header>
<section class=entry-content>
<p>ç»™å®šä¸€ä¸ªpair&lt;int, int>æ•°ç»„,é€šè¿‡è‡ªå®šä¹‰æ’åºé¡ºåºå†³å®šä¼˜å…ˆé˜Ÿåˆ—ä¸­çš„é¡ºåº.
vector&lt;pair&lt;int, int>> nums{{4, 1}, {8, 2}, {1, 9}, {8, 1}, {8, 4}, {3, 7}}; ä»¿å‡½æ•° (æ¨è) ä»¿å‡½æ•°çš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³å‡½æ•°æŒ‡é’ˆåœ¨ä½œä¸ºå‡½æ•°å‚æ•°å‘å‡½æ•°ä¼ é€’æ—¶çš„å±€é™æ€§é—®é¢˜. é€šè¿‡é‡å†™ç±»çš„operator(),ä½¿è¯¥ç±»å…·æœ‰å‡½æ•°çš„åŠŸèƒ½.
struct cmp { bool operator() (const pair&lt;int, int> &a, const pair&lt;int, int> &b) { return a.first == b.first? a.second &lt; b.second : a.first &lt; b.first; } }; priority_queue&lt;pair&lt;int, int>, vector&lt;pair&lt;int, int>>, cmp> pq; lambda é€šè¿‡c++11æ–°ç‰¹æ€§çš„lambdaå’Œdelctype,å¯ä»¥é¿å…é‡æ–°å®šä¹‰ç±». ä½†éœ€è¦æ³¨æ„,lambdaå‡½æ•°éœ€è¦é€šè¿‡æ„é€ å‡½æ•°çš„å‚æ•°ä¼ é€’.
auto a = [](const pair&lt;int, int> & a, const pair&lt;int, int> &b){ return a.first == b....</p>
</section>
<footer class=entry-footer>10-7&nbsp;Â·&nbsp;yuler</footer>
<a class=entry-link aria-label="post link to priority_queueè‡ªå®šä¹‰æ’åº" href=https://zhangyh.me/posts/cpp/priority-queue-custom-comparator/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>FloDB: Unlocking Memory in Persistent Key-Value Stores
</h2>
</header>
<section class=entry-content>
<p>Shortcomings of current LSMs çº¿ç¨‹çš„å¯æ‰©å±•æ€§ LevelDBå…è®¸ä¸€å®šç¨‹åº¦çš„å¹¶å‘å†™ï¼Œä½†å†…éƒ¨æ˜¯å°†å†™å…¥æ“ä½œå†™åˆ°äº†ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œæœ€åä»æ˜¯é¡ºåºæ‰§è¡Œã€‚ HyperLevelDBã€RocksDBã€cLSMåšäº†ä¸€å®šç¨‹åº¦çš„å¹¶è¡Œä¼˜åŒ–
å†…å­˜çš„å¯æ‰©å±•æ€§ å†…å­˜ä¸­ç»„ä»¶å¯ä»¥æ˜¯æœ‰åºè·³è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯æ— åºå“ˆå¸Œè¡¨ï¼Œä½†äºŒè€…éƒ½ä¸é€‚åˆåº”ç”¨åˆ°æ›´å¤§çš„å†…å­˜ä¸­ã€‚ å¯¹äºè·³è¡¨è€Œè¨€ï¼Œè¯»å†™æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯$O(logn)$ï¼Œæœ‰åºæ€§ä¸€å®šç¨‹åº¦ä¼˜åŒ–äº†èŒƒå›´æŸ¥è¯¢ï¼Œå¹¶åŠ é€Ÿäº†flushè¿‡ç¨‹ã€‚ä½†ä¸€èˆ¬æ¥è¯´ï¼Œè¯»å–æ“ä½œéƒ½è¦åˆ°è¾¾ç£ç›˜ï¼Œå› æ­¤ï¼Œè·³è¡¨å¯¹å†™å…¥çš„è´Ÿé¢å½±å“å¤§äºå¯¹è¯»å–çš„æ­£é¢å½±å“ã€‚å¯¹äºæ›´å¤§å†…å­˜ä¸­æ›´å¤§çš„è·³è¡¨ï¼Œè¯»å†™å»¶è¿Ÿå¾€å¾€ä¼šæé«˜ã€‚ å¯¹äºå“ˆå¸Œè¡¨è€Œè¨€ï¼Œè¯»å†™æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯$O(1)$ï¼Œæ— åºæ€§å¢åŠ äº†èŒƒå›´æŸ¥è¯¢å’Œflushè¿‡ç¨‹çš„å·¥ä½œé‡ã€‚ä½†å“ˆå¸Œè¡¨éœ€è¦æ›´é•¿çš„æ—¶é—´æ’åºï¼Œsizeè¶Šå¤§ï¼Œæ‰€éœ€æ—¶é—´è¶Šé•¿ï¼Œä¼šé˜»å¡ä¸Šå±‚çš„å†™å…¥æ“ä½œã€‚
FloDB Design è®¾è®¡äº†ä¸¤å±‚çš„å†…å­˜ç»„ä»¶ï¼Œä¸Šå±‚æ˜¯smallã€fastã€unorderedçš„Membufferï¼Œä¸‹å±‚æ˜¯largerã€orderedçš„Memtableã€‚ä¸¤å±‚éƒ½æ˜¯å¯å¹¶è¡Œçš„æ•°æ®ç»“æ„ï¼Œæ•°æ®æµè·ŸLSMç±»ä¼¼ï¼Œä»æœ€å°çš„Membufferï¼Œæµå‘Memtableï¼Œç›´åˆ°ç£ç›˜ä¸Šçš„SStableã€‚
Get æœç´¢é¡ºåºï¼šMembuffer -> Memtable -> SStable
Update Putå’ŒDeleteæ“ä½œå’ŒUpdateæ˜¯ç›¸ä¼¼çš„ã€‚ é¦–å…ˆå°è¯•åœ¨Membufferæ›´æ–°ï¼Œå¦‚æœMembufferæ»¡äº†ï¼Œå°±ç›´æ¥åœ¨Memtableä¸Šå®Œæˆæ›´æ–°ã€‚ï¼ˆå‡å¦‚è¯´Membufferæˆ–Memtableä¸Šæœ‰å¯¹åº”å€¼çš„è¯ï¼Œæ›´æ–°å°±æ˜¯in-placeçš„ï¼‰
æ›¿ä»£çš„æ–¹æ¡ˆå°±æ˜¯mulit-versionæ›´æ–°ï¼Œç„¶è€Œå¯¹æ¯”èµ·æ¥ï¼Œin-placeæ›´æ–°åœ¨skewedçš„å·¥ä½œè´Ÿè½½ä¸Šå…·æœ‰æ›´å¥½çš„è¡¨ç°ã€‚
Scan æ‰«æMemtableå’Œdiskï¼ŒåŒæ—¶å…è®¸Membufferè¿›è¡Œå¹¶è¡Œçš„updateã€‚ æŒ‘æˆ˜1ï¼šMembufferæœ‰å¯¹åº”çš„æ•°æ®ï¼Œå› æ­¤æ‰«æå‰å…ˆæ¸…ç©ºMembufferåˆ°Memtableä¸Šã€‚ æŒ‘æˆ˜2ï¼šlong-timeçš„æ‰«æå¯¼è‡´Membufferå˜æ»¡ï¼Œå…è®¸writerå’Œsanneråœ¨Memtableä¸Šå¹¶è¡Œã€‚è¿™ä¸ªæ—¶å€™å¯èƒ½ä¼šå¯¼è‡´ä¸ä¸€è‡´æ€§ï¼Œå› æ­¤æˆ‘ä»¬è®°å½•scanæ—¶çš„sequence numberï¼Œæ‰«æåçš„ç»“æœä¸­å¦‚æœæœ‰å¤§äºè¯¥å€¼çš„entryï¼Œåˆ™é‡æ–°æ‰«æã€‚
FloDB Implementation æ˜ç¡®äº†å››å„æ–¹é¢:
Membufferå’ŒMemtableæ•°æ®ç»“æ„çš„é€‰æ‹© æ•°æ®ä»Membufferåˆ°Memtableç§»åŠ¨çš„æœºåˆ¶ æ–°é¢–çš„å¤šæ’å…¥æ“ä½œç”¨äºç®€åŒ– Memtable å’Œ Membuffer ä¹‹é—´çš„æ•°æ®æµ é¢å‘ç”¨æˆ·çš„æ“ä½œçš„å®ç° Memory Component Implementation Membuffer -> Hash Table Memtable -> Skiplist
Interaction Between Levels åŒ…æ‹¬persistingå’Œdraining.
Skiplist Multi-inserts å®éªŒæ˜¾ç¤ºï¼Œå¤šçº¿ç¨‹ä¸‹hash tableæ¯”skiplistå—ä¸€åˆ°ä¸¤ä¸ªæ•°é‡çº§ã€‚å› æ­¤åº”è¯¥å°½å¿«åœ°å®Œæˆç§»åŠ¨ï¼Œä½¿å¾—updateåœ¨hash tableä¸Šè¿›è¡Œã€‚
æ‰¹é‡çš„æ’å…¥å¤šä¸ªkvå¯¹åˆ°skiplistä¸­ï¼Œè€Œä¸æ˜¯æŒ¨ä¸ªæ’å…¥ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯æˆ‘ä»¬èƒ½ç›´æ¥åˆ©ç”¨å‰ä¸€ä¸ªkvå¯¹çš„preæŒ‡é’ˆï¼Œè€Œä¸æ˜¯é‡æ–°æ‰¾ï¼Œæœ‰path-reuseçš„æ€æƒ³åœ¨é‡Œé¢ã€‚
å¹¶è¡Œæ€§ã€‚æ’å…¥å’Œinsertã€readå¹¶è¡Œã€‚
keyçš„ä¸´è¿‘åº¦å†³å®šäº†path-reuseçš„æ•ˆæœã€‚</p>
</section>
<footer class=entry-footer>9-26&nbsp;Â·&nbsp;yuler</footer>
<a class=entry-link aria-label="post link to FloDB: Unlocking Memory in Persistent Key-Value Stores" href=https://zhangyh.me/posts/paper/sep/flodb/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>SFM: Mitigating Read/Write Amplification Problem of LSM-Tree-Based Key-Value Stores
</h2>
</header>
<section class=entry-content>
<p>Movitation ä¼ ç»Ÿçš„merge policy Level Merge Policyå’ŒTiered Merge Policyåœ¨è¯»å†™æ”¾å¤§æ–¹é¢å„æœ‰ä¼˜åŠ¿. å‰è€…ç›¸å½“äºå•å±‚çš„Tiered,ä¿è¯äº†å•å±‚æ•°æ®çš„æœ‰åºæ€§,å‡å°‘äº†è¯»æ”¾å¤§,ä½†è¦ç»´æŠ¤è¿™ç§æœ‰åºæ€§,å°±éœ€è¦é¢‘ç¹çš„merge,å› æ­¤é€ æˆäº†ä¸¥é‡çš„å†™æ”¾å¤§. åè€…å¯¹æœ‰åºæ€§çš„è¦æ±‚å¹¶ä¸ä¸¥æ ¼,å®ƒåªè¦æ±‚æ¯ä¸ªgroupçš„key rangeäº’ä¸äº¤å‰,å…è®¸sstableä¹‹é—´çš„keyäº¤å‰.
å·¥ä½œè´Ÿè½½çš„ç©ºé—´å±€éƒ¨æ€§ ä½œè€…å¯¹ZippyDB(facebook)çš„å·¥ä½œè´Ÿè½½åˆ†æå‘ç°,å°‘éƒ¨åˆ†çš„keyè¢«è¯»å†™å¤šæ¬¡,å¤§éƒ¨åˆ†çš„keyè¢«è¯»å†™çš„æ¬¡æ•°å¾ˆå°‘.
Design ä½œè€…æå‡ºäº†ç–‘é—®:
How to resolve the read amplification problem induced by the tiering merge policy while maintaining its low write amplification?
æ ¹æ®key-spaceçš„ä¸åŒaccess pattern,æœ‰é€‰æ‹©çš„é‡‡ç”¨Tieringå’ŒLeveling Merge policy. é€šè¿‡è¿½è¸ªæ¯å±‚ä¸­çš„key-spaceçš„è®¿é—®å¼ºåº¦,æ¥å†³å®šè®¾ç½®Tçš„å€¼ä¸º1è¿˜æ˜¯configured threshold.
Spatially Fragmented LSM-TREE (SFM) æ¯å±‚é€šè¿‡éšæœºçš„è¾¹ç•Œåˆ†ä¸ºä¸åŒçš„key-space.è¾¹ç•Œçš„é€‰å–æ–¹å¼ç±»ä¼¼äºPebblesDB. å¦‚æœä¸€ä¸ªæ ˆçš„key-rangeè¢«è®¤ä¸ºæ˜¯è¯»å¯†é›†çš„,åˆ™è®¾ç½®Tä¸º1,å¦åˆ™,æŒ‰ç…§åŸæœ‰çš„é…ç½®è®¾ç½®.
åˆå¹¶ç­–ç•¥å¦‚ä¸Šå›¾
è¯»è¶…è¿‡stacké˜ˆå€¼çš„æ–‡ä»¶åˆ°å†…å­˜ åœ¨å†…å­˜ä¸­è¿›è¡Œmerge æŒ‰ç…§ä¸‹å±‚çš„keyè¾¹ç•Œè¿›è¡Œåˆ‡ç‰‡ æ–°SSTableè¢«åˆ·æ–°åˆ°ä¸‹å±‚ æ·»åŠ åˆ°keyå¯¹åº”çš„æ ˆ B. Read Intensity Identification å¦‚ä½•åˆ¤æ–­è¯»çš„å¼ºåº¦å‘¢? ç»Ÿè®¡æ¯ä¸ªæ®µçš„è¯»å†™æ¬¡æ•°.å¯¹äºè¯»æ“ä½œ,å³ä½¿è¯»å–çš„keyä¸å­˜åœ¨,ä¹Ÿæ˜¯è¦è®¡å…¥è¯»å–æ¬¡æ•°çš„. å¯¹äºå†™æ“ä½œ,ç»Ÿè®¡æ¯æ¬¡mergeåçš„sstableä¸­çš„kvå¯¹çš„æ•°é‡. é€šè¿‡å¯¹æ¯”æ¯ä¸ªstackçš„r/wå’Œæ•´ä½“å¹³å‡çš„r/wæ¥åˆ¤æ–­å…¶ä¸ºhotè¿˜æ˜¯cold. æ ¹æ®æ¯ä¸ªstackçš„hotè¿˜æ˜¯coldå±æ€§,æ¥å†³å®škey-spaceçš„è®¿é—®å¼ºåº¦.
Metadata Managment é€šè¿‡StackMetadataçš„æ•°æ®ç»“æ„æ¥ç®¡ç†æ¯ä¸ªstackçš„å…ƒä¿¡æ¯....</p>
</section>
<footer class=entry-footer>9-24&nbsp;Â·&nbsp;yuler</footer>
<a class=entry-link aria-label="post link to SFM: Mitigating Read/Write Amplification Problem of LSM-Tree-Based Key-Value Stores" href=https://zhangyh.me/posts/paper/sep/sfm/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>SILK: Preventing Latency Spikes in Log-Structured Merge Key-Value Stores
</h2>
</header>
<section class=entry-content>
<p>æœ¬æ–‡æ—¨åœ¨è§£å†³LSM-Treeçš„é•¿å°¾é—®é¢˜ï¼Œé•¿å°¾é—®é¢˜çš„æ ¹æºä¸»è¦æ˜¯å®¢æˆ·ç«¯æ“ä½œå’ŒLSM-Treeå†…éƒ¨æ“ä½œçš„äº’ç›¸å¹²æ‰°ã€‚ å®¢æˆ·ç«¯æ“ä½œï¼šwrite å†…éƒ¨æ“ä½œ: flushã€compaction
Experiment study of tail latency å®éªŒä¸€ï¼šå¯¹æ¯”RocksDBå’ŒRocksDB without flushing. RocksDB without flushing: è¦flushçš„immutable memtableç›´æ¥ä¸¢å¼ƒ å®éªŒäºŒï¼šRate-limited RocksDB å®éªŒä¸‰ï¼šRocksDB with increased Memtable å®éªŒå››ï¼šTRAID å®éªŒäº”ï¼šPebblesDB ä½œè€…å¯¹ç›®å‰æœ€æ–°çš„LSM-Treeæ•°æ®åº“RocksDBã€TRIADã€PebblesDBè¿›è¡Œäº†å®éªŒå¹¶å¾—å‡ºä¸‰ç‚¹ç»“è®ºã€‚
é•¿å°¾çš„ä¸»è¦åŸå› æ˜¯è¢«å†™æ»¡çš„memtableé˜»å¡äº†writeã€‚ æœ‰ä¸¤ä¸ªåŸå› å¯¼è‡´äº†è¿™ç§æƒ…å†µï¼šç¬¬ä¸€ï¼Œç£ç›˜ä¸Šçš„L0-L1 compactionè·Ÿä¸ä¸Šå†™å…¥çš„é€Ÿåº¦ï¼Œå¯¼è‡´L0è¢«å†™æ»¡ã€‚ç¬¬äºŒï¼Œæ„å¤–çš„æœ‰å¤§é‡çš„compactionåœ¨åŒæ—¶è¿›è¡Œï¼Œå æ®äº†å¤§é‡çš„IOï¼Œå¯¼è‡´flushå› ä¸ºæœ‰é™çš„å¸¦å®½è€Œå˜æ…¢ï¼Œä½¿å¾—memtableå˜æ»¡ã€‚ ç®€å•çš„é™åˆ¶å†…éƒ¨æ“ä½œå¸¦å®½, å¹¶ä¸èƒ½è§£å†³flushå¸¦å®½å—é™çš„é—®é¢˜ï¼Œé•¿è¿œæ¥çœ‹åè€Œä¼šåŠ å‰§è¿™ç§é—®é¢˜ã€‚è¿™ç§æ–¹æ³•èƒ½å¤Ÿæ¨è¿Ÿå‹ç¼©ï¼Œä½†å¢åŠ äº†åœ¨æœªæ¥æŸä¸ªæ—¶å€™åŒæ—¶å‘ç”Ÿcompactionçš„å¯èƒ½æ€§ã€‚ æé«˜ååé‡çš„æ–¹æ³•ï¼Œä¾‹å¦‚é€‰æ‹©æ€§åœ°å¯åŠ¨å‹ç¼©æˆ–ä»…åœ¨æœ€é«˜levelæ‰§è¡Œå‹ç¼©ï¼Œåœ¨çŸ­æœŸå†…é¿å…äº†å»¶è¿Ÿå³°å€¼ï¼Œä½†ä»é•¿è¿œæ¥çœ‹ä¼šåŠ å‰§é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬ä¹Ÿä¼šå¢åŠ åœ¨ç¨åçš„æŸä¸ªæ—¶é—´ç‚¹è¿›è¡Œè®¸å¤šå¹¶å‘å‹ç¼©çš„å¯èƒ½æ€§ã€‚ æ¨è®ºï¼š ç”±1å¾—å‡ºæ¨è®ºï¼šå†…éƒ¨æ“ä½œå¹¶ä¸æ˜¯å®Œå…¨å¹³ç­‰çš„ã€‚æ›´low-levelçš„æ“ä½œæ˜¯å…³é”®çš„ï¼Œå› ä¸ºæœªèƒ½åŠæ—¶å®Œæˆå®ƒä»¬å¯èƒ½ä¼šå¯¼è‡´å®¢æˆ·ç«¯æ“ä½œåœæ»ã€‚ ç”±2ï¼Œ3å¾—å‡ºæ¨è®ºï¼šå¿…é¡»è¿›è¡Œé•¿æ—¶é—´çš„æµ‹è¯•ï¼Œé¿å…é—®é¢˜æœªè¢«å‘ç°ã€‚ (å› ä¸ºå†™å…¥çš„æ•°æ®é‡ä¸å¤Ÿçš„è¯ï¼Œæ— æ³•ä½“ç°æ›´åº•å±‚çš„compactionæ“ä½œå¯¹ç³»ç»Ÿçš„å½±å“ã€‚)
SILK Design principles æœ‰é€‰æ‹©çš„åˆ†é…å¸¦å®½ã€‚ é‡åˆ°å³°å€¼æµé‡æ—¶ï¼Œåˆ†é…æ›´å¤šçš„å¸¦å®½ç»™low-levelï¼Œå‡ç¼“high-levelçš„å‹ç¼©ã€‚ åœ¨é—²æ—¶ï¼Œåˆ©ç”¨çŸ­æš‚çš„ä½è´Ÿè½½æ—¶æœŸæ¥ä¿ƒè¿›å†…éƒ¨æ“ä½œçš„å¤„ç† ä¼˜å…ˆå¤„ç†æ›´low-levelçš„æ“ä½œ ç»™å†…éƒ¨æ“ä½œæŒ‡å®šä¼˜å…ˆçº§: flush > L0-L1 compaction > high-level compaction æŠ¢å å¼compaction å…è®¸æ›´low-levelçš„compactionæŠ¢å high-levelçš„compaction Implementation æœ‰é€‰æ‹©çš„åˆ†é…å¸¦å®½ æœ‰ä¼˜å…ˆæ¬¡åºå’Œå¯æŠ¢å çš„å†…éƒ¨æ“ä½œ ç³»ç»Ÿå†…éƒ¨ç»´æŠ¤ä¸¤ä¸ªçº¿ç¨‹æ± ï¼šé«˜ä¼˜å…ˆçº§æ± ç”¨äºflush,ä½ä¼˜å…ˆçº§æ± ç”¨äºcompaction. Flush: æœ‰ä¸“é—¨çš„çº¿ç¨‹æ± ï¼Œåœ¨memè¢«å†™æ»¡ä¹‹å‰ï¼Œæä¾›ç¨³å®šçš„ä¸€å®šé‡çš„å¸¦å®½ï¼Œä»¥ä¿è¯ä¸æ–­çš„å†™å…¥ã€‚å¤šä¸ªå†…å­˜ç»„ä»¶å’Œå¤šä¸ªçº¿ç¨‹å¯èƒ½ä¿è¯è¾ƒé•¿çš„æ€§èƒ½é«˜å³°ã€‚ L0-L1 compaction: å’Œhigh-levelçš„compactionå…±ç”¨çº¿ç¨‹ï¼Œè¯¥è¿‡ç¨‹éœ€è¦ä¿è¯L0æœ‰è¶³å¤Ÿçš„ç©ºé—´ä¾›flushã€‚å¦‚æœéœ€è¦è¿›è¡ŒL0-L1çš„compactionï¼Œå¹¶ä¸”ç›®å‰æ²¡æœ‰å¯ç”¨çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ä¼šæŠ¢å high-leve compactionçš„çº¿ç¨‹ã€‚ high-level compaction: çº¿ç¨‹ç»´æŠ¤åœ¨ä½ä¼˜å…ˆçº§çº¿ç¨‹æ±  </p>
</section>
<footer class=entry-footer>9-22&nbsp;Â·&nbsp;yuler</footer>
<a class=entry-link aria-label="post link to SILK: Preventing Latency Spikes in Log-Structured Merge Key-Value Stores " href=https://zhangyh.me/posts/paper/sep/silk/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>weekly-contest-259
</h2>
</header>
<section class=entry-content>
<p>ç¬¬259æ¬¡å‘¨èµ› A. æ‰§è¡Œæ“ä½œåçš„å˜é‡å€¼ æ—¶é—´å¤æ‚åº¦: $O(n)$ ç©ºé—´å¤æ‚åº¦: $O(1)$ class Solution { public: int finalValueAfterOperations(vector&lt;string>& operations) { int X = 0; for (auto & s: operations) { if (s[1] == '+') X++; else X--; } return X; } }; B. æ•°ç»„ç¾ä¸½å€¼æ±‚å’Œ é€šè¿‡æ­£åä¸¤æ¬¡éå†è®°å½•æ¯ä¸ªå€¼å·¦è¾¹çš„æœ€å¤§å€¼å’Œå³è¾¹çš„æœ€å°å€¼.
æ—¶é—´å¤æ‚åº¦: $O(n)$ ç©ºé—´å¤æ‚åº¦: $O(n)$ class Solution { public: int sumOfBeauties(vector&lt;int>& nums) { int n = nums.size(); vector&lt;int> left(n, INT_MIN), right(n, INT_MAX); int ans = 0; left[0] = nums[0]; right[n - 1] = nums[n - 1]; for (int i = 1; i &lt; n; i++) left[i] = max(left[i-1], nums[i]); for (int i = n - 2; i >= 0; i--) right[i] = min(right[i + 1], nums[i]); for (int i = 1; i &lt; n - 1; i++) { if (left[i - 1] &lt; nums[i] && nums[i] &lt; right[i + 1]) ans +=2; else if (nums[i - 1] &lt; nums[i] && nums[i] &lt; nums[i + 1]) ans++; } return ans; } }; C....</p>
</section>
<footer class=entry-footer>9-20&nbsp;Â·&nbsp;yuler</footer>
<a class=entry-link aria-label="post link to weekly-contest-259" href=https://zhangyh.me/posts/leetcode/weekly-contest-259/></a>
</article>
<footer class=page-footer>
<nav class=pagination>
<a class=next href=https://zhangyh.me/page/2/>Next Page Â»</a>
</nav>
</footer>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://zhangyh.me/>yuler's blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>